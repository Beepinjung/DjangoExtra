{% extends 'base.html' %}

{% block content %}
<div class="max-w-xl mx-auto mt-10 bg-white p-8 rounded-lg shadow-md">
  <h2 class="text-2xl font-bold text-center text-blue-600 mb-6">
    {% if form.instance.pk %}Edit{% else %}Create{% endif %} Task
  </h2>

  <form method="post" class="space-y-4">
    {% csrf_token %}
    {% for field in form %}
      <div id="field-{{ field.name }}" {% if field.name == "secret_password" and not form.initial.is_secret %}style="display:none;"{% endif %}>
        <label class="block text-sm font-medium text-gray-700 mb-1">{{ field.label }}</label>
        {{ field }}
        {% if field.errors %}
          <p class="text-red-500 text-sm mt-1">{{ field.errors.0 }}</p>
        {% endif %}
      </div>
    {% endfor %}

    <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-md font-medium">
      Save Task
    </button>
  </form>

  <div class="text-center mt-6">
    <a href="{% url 'task-list' %}" class="text-sm text-blue-500 hover:underline">‚Üê Back to Task List</a>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const secretCheckbox = document.querySelector('input[name="is_secret"]');
    const passwordFieldDiv = document.getElementById('field-secret_password');

    function togglePasswordField() {
      if (secretCheckbox.checked) {
        passwordFieldDiv.style.display = 'block';
      } else {
        passwordFieldDiv.style.display = 'none';
        // Optionally clear password input when hidden
        const pwdInput = passwordFieldDiv.querySelector('input');
        if (pwdInput) pwdInput.value = '';
      }
    }

    if(secretCheckbox) {
      secretCheckbox.addEventListener('change', togglePasswordField);
      togglePasswordField();  // Run on page load to set initial visibility
    }
  });
</script>
{% endblock %}
